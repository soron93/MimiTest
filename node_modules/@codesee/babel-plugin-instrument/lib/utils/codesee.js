"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.getStackFrameIdIdentifier=exports.findStackFrameIdIdentifier=exports.hasCodeSeeTracking=exports.isFuncInputsStatement=exports.hasCodeSeeInstrumentation=exports.isCodeSeeCallExpr=exports.isStackFrameEnterStatement=exports.codeSeeCall=void 0;var _constants=require("../constants"),_utils=require("./utils"),t=require("@babel/types"),codeSeeCall=function(a,b,c){var d=a.callExpression(a.memberExpression(a.identifier("CodeSee"),a.identifier(b)),c);d.codesee=!0;return d};exports.codeSeeCall=codeSeeCall;var isStackFrameEnterStatement=function(a){if(a.isVariableDeclaration()&&a.get("declarations")[0].get("init").isCallExpression()&&a.get("declarations")[0].get("init").get("callee").isMemberExpression()&&"CodeSee"===a.node.declarations[0].init.callee.object.name&&a.node.declarations[0].init.callee.property.name===_constants.codeSeeStackframe){return!0}return!1};exports.isStackFrameEnterStatement=isStackFrameEnterStatement;var isCodeSeeCallExpr=function(a){if(a.isCallExpression()&&a.get("callee").isMemberExpression()&&"CodeSee"===a.node.callee.object.name){return!0}return!1};exports.isCodeSeeCallExpr=isCodeSeeCallExpr;var isCodeSeeSourceExpr=function(a){if(isCodeSeeCallExpr(a)){return"CodeSee"===a.node.callee.object.name&&"source"===a.node.callee.property.name}return!1},hasCodeSeeInstrumentation=function(a){for(var b=a.get("body"),c=0;c<b.length;c++){if(b[c].isExpressionStatement()){if(isCodeSeeSourceExpr(b[c].get("expression"))){return!0}}}return!1};exports.hasCodeSeeInstrumentation=hasCodeSeeInstrumentation;var isFuncInputsStatement=function(a){if(a.isExpressionStatement()&&isCodeSeeCallExpr(a.get("expression"))&&a.node.expression.callee.property.name===_constants.codeSeeFuncParams){return!0}return!1};exports.isFuncInputsStatement=isFuncInputsStatement;var hasCodeSeeTracking=function(a){var b={found:!1};a.traverse({CallExpression:function CallExpression(a,b){if(isCodeSeeCallExpr(a)||a.get("callee").isSuper()){b.found=!0;a.stop()}}},b);return b.found};exports.hasCodeSeeTracking=hasCodeSeeTracking;var findStackFrameIdIdentifier=function(a){var b=[a.parentKey],c=a.parentPath,d=c.find(function(a){b.unshift(a.parentKey);return a.isFunction()||a.isProgram()||a.isClassProperty({static:!1})});if(d.isClassProperty()){var e=d.parentPath,f=e.get("body").find(function(a){return a.isClassMethod({kind:"constructor"})});if(!f){console.error("CodeSee Internal Error: Found class without constructor, even after constructor generation?");return t.identifier("undefined")}else{var i=getStackFrameIdIdentifier(f);if(i===void 0){return}var g=i,h=t.parenthesizedExpression(t.conditionalExpression(t.binaryExpression("!==",t.unaryExpression("typeof",g,!0),t.stringLiteral("undefined")),g,t.identifier("undefined")));return h}}if(d.isClassMethod()||d.isObjectMethod()){if("key"===b[1]){return findStackFrameIdIdentifier(d)}}return getStackFrameIdIdentifier(d)};exports.findStackFrameIdIdentifier=findStackFrameIdIdentifier;var getStackFrameIdIdentifier=function(a){if(a.node.stackFrameId){return a.node.stackFrameId}if(a.node.loc===void 0){return}var b=(0,_utils.generateTempIdentifier)(a.scope,"stackFrameId");a.node.stackFrameId=b;return b};exports.getStackFrameIdIdentifier=getStackFrameIdIdentifier;